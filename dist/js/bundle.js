!function(){"use strict";function t(t){t.html5Mode(!0)}angular.module("orchestra.config",[]).config(t)}(),angular.module("orchestra.constants",[]).constant("SPOTIFY",{DEFAULT_AJAX_OPTIONS:{headers:{Origin:"https://embed.spotify.com"},method:"GET"},EXTENSION_ID:"opejcnahjldejgcoegkepenfbomiejic",HOST:"https://tpcaahshvs.spotilocal.com:",OAUTH_URI:"http://open.spotify.com/token",REMOTE_PATH:"/remote",STARTING_PORT:4370,TOKEN_PATH:"/simplecsrf/token.json?&ref=&cors="}),function(){"use strict";angular.module("orchestra",["orchestra.config","orchestra.app.state","orchestra.home","orchestra.channel","orchestra.auth.service","orchestra.firebase.service","orchestra.player.service","orchestra.spotify.service","orchestra.time.service","firebase"]).constant(_,window._).run(function(t,e){e.$on("$stateChangeError",function(e,n,r,o,a,c){t.error("Error in state transistion: ",c)})})}(),function(){"use strict";function t(t){t.state("orchestra",{"abstract":!0})}angular.module("orchestra.app.state",["orchestra.spotify.service","orchestra.templates","ui.router"]).config(t)}(),function(){"use strict";function t(t,e,n,r,o,a,c){function s(){t(function(){c.status().then(function(t){a.setCurrentStatus(t),e.channel.currentStatus=a.getCurrentStatus()})},2e3)}function u(){e.$watch(function(){return e.channel.currentStatus.playing},function(t){t||a.pause()}),e.$watch(function(){return e.channel.currentStatus.song.url},function(){a.play(e.channel.currentStatus.song,e.channel.currentStatus.playingPosition)}),e.$watch(function(){return e.channel.currentStatus.playingPosition},function(t,n){i(t,n)&&l()&&a.play(e.channel.currentStatus.song,t)})}function i(t,e){return Math.abs(t-e)>10}function l(){return e.channel.currentStatus.song.url===a.getCurrentStatus().song.url}var h=this;h.channelId=n.channelId,h.isAdmin=r.getUser().uid===n.channelId,e.channel={currentStatus:{playing:!1,song:{}}},o.getChannel(n.channelId).$bindTo(e,"channel"),h.isAdmin?s():u()}angular.module("orchestra.channel.controller",["firebase","orchestra.auth.service","orchestra.firebase.service","orchestra.player.service","orchestra.spotify.service","ui.router"]).controller("ChannelController",t)}(),function(){"use strict";angular.module("orchestra.channel",["orchestra.channel.state"])}(),function(){"use strict";function t(t){console.log("channel state"),t.state("orchestra.channel",{url:"/channel/:channelId",views:{"main@":{templateUrl:"channel/channel.tpl.html",controller:"ChannelController as channelController"}}})}angular.module("orchestra.channel.state",["orchestra.channel.controller","orchestra.templates","ui.router"]).config(t)}(),function(){"use strict";function t(t,e){function n(){t.go("orchestra.channel",{channelId:e.getUser().uid})}var r=this;r.createChannel=n}angular.module("orchestra.home.controller",["orchestra.auth.service"]).controller("HomeController",t)}(),function(){"use strict";angular.module("orchestra.home",["orchestra.home.state"])}(),function(){"use strict";function t(t){t.state("orchestra.home",{url:"/",views:{"main@":{templateUrl:"home/home.tpl.html",controller:"HomeController as homeController"}}})}angular.module("orchestra.home.state",["orchestra.home.controller","orchestra.templates","ui.router"]).config(t)}(),function(){"use strict";angular.module("orchestra.player.service",["orchestra.constants","orchestra.spotify.service"]).factory("player",function(t){function e(){return s}function n(){t.pause().then(function(t){a(t)})}function r(e,n){t.play(e,n).then(function(t){a(t)})}function o(){t.status().then(function(t){a(t)})}function a(t){var e=t.track;s.playing=t.playing,s.playing&&(s.song.name=e.track_resource.name,s.song.url=e.track_resource.uri,s.song.artist=e.artist_resource.name,s.playingPosition=t.playing_position)}var c={getCurrentStatus:e,pause:n,play:r,setCurrentStatus:a,status:o},s={playing:!1,playingPosition:0,song:{name:null,artist:null,url:null}};return c})}(),function(){"use strict";angular.module("orchestra.auth.service",["firebase","orchestra.firebase.service"]).factory("auth",function(t,e,n){function r(){return c.getAuth()}function o(){return s.getUser()?e.when(s.getUser()):a.$authAnonymously()}var a,c=n.getReference(),s={getUser:r,login:o};return a=t(c),o(),s})}(),function(){"use strict";angular.module("orchestra.firebase.service",["firebase"]).factory("firebase",function(t){function e(e){return t(r.child("channels").child(e))}function n(){return r}var r=new Firebase("https://ammo-sync.firebaseio.com/"),o={getReference:n,getChannel:e};return o})}(),function(){"use strict";angular.module("orchestra.time.service",[]).factory("time",function(){function t(t){var e,n;return isNaN(t)?"":(e=Math.floor(t/60),n=Math.floor(t-60*e),"#"+e+":"+n)}var e={convertTime:t};return e})}(),function(){"use strict";angular.module("orchestra.spotify.service",["orchestra.constants","orchestra.time.service"]).factory("spotify",function(t,e,n,r){function o(){var e=t.defer();return d.isReady()?t.when():(g(e),a(n.STARTING_PORT).then(function(){return c()}).then(function(t){return y.csrf=t.token,s()}).then(function(t){y.oauth=t.t,p=!0,e.resolve()}),e.promise)}function a(e,r,o){var c;return o=o||1,r=r||t.defer(),c=_.merge({},n.DEFAULT_AJAX_OPTIONS,{url:n.HOST+e+n.TOKEN_PATH}),m(c).then(function(){T=e,r.resolve(T)})["catch"](function(){20>o?a(e+1,r,o+1):r.reject("Spotify Client not found.")}),r.promise}function c(){return m({url:n.HOST+T+n.TOKEN_PATH})}function s(){return m({url:n.OAUTH_URI})}function u(t,e){var o=t.url?t.url.replace("track","trackset:dummy"):"";return f({url:n.HOST+T+n.REMOTE_PATH+"/play.json",params:{uri:t.url+r.convertTime(e),context:o}})}function i(){return f({url:n.HOST+T+n.REMOTE_PATH+"/pause.json",params:{pause:!0}})}function l(){return f({url:n.HOST+T+n.REMOTE_PATH+"/status.json"})}function h(){return p}function f(t){return o().then(function(){return m(t)})}function m(e){var r=t.defer(),o=n.EXTENSION_ID;return e=_.merge(e,n.DEFAULT_AJAX_OPTIONS,{params:y}),console.log(e),chrome.runtime.sendMessage(o,e,function(t){t.error&&r.reject(t.error),r.resolve(t.data)}),r.promise}function g(t){e(function(){t.reject("Spotify Client not Found")},2e3)}var p=!1,d={isReady:h,pause:i,play:u,status:l},T=n.STARTING_PORT,y={};return d})}();